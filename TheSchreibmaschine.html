<!DOCTYPE html>
<html lang="de">
    <head>
        <title>TheSchreibmaschine</title>

        <meta name="author" content="Dennis Guse (dennis.guse@alumni.tu-berlin.de)"></meta>
        <meta name="license" content="GPLv3" hidden="hidden">
        <!-- http://www.gnu.org/licenses/gpl-3.0.txt -->
        </meta>
        <meta name="description" content="TheSchreibmaschine. A distraction-free (almost feature-free) keyboard text editor. Focus on what you need."></meta>
        <meta name="version" content="Not yet set."></meta>

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

        <meta charset="UTF-8">

        <link rel="icon" type="image/gif" href="data:image/gif;base64,R0lGODlhQABAAPABABEREf///yH5BAAAAAAALAAAAABAAEAAAAJujI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8cYAMgUbU94Hu384/s1gsIFsZg4Ig/KZaC5hCKlRarQ+sPytDmuzSsDx8Qw8svsQrfULPbKrYKn5Cj6yW7Cl/TOvv8PGCg4SFhoeIiYqLjYUQAAOw=="/>
        <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxyZWN0IHdpZHRoPSIyIiBoZWlnaHQ9IjMyIiB5PSIxNiIgeD0iMzEiIHN0eWxlPSJmaWxsOiMxMTEiPgogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgYXR0cmlidXRlVHlwZT0iQ1NTIiBiZWdpbj0iMHMiIGR1cj0iM3MiIHZhbHVlcz0iMTsxOzAuMjsxIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgLz4KICA8L3JlY3Q+Cjwvc3ZnPgo="/>

        <script type="text/javascript">
            function handleKeyDown(event) {
                console.log(event);
                switch (event.keyCode) {
                    //Navigation
                    case 33: //Page-Up
                        soundTypewriter();
                        moveCursorUp();
                        moveCursorUp();
                        moveCursorUp();
                        moveCursorUp();
                        moveCursorUp();
                        break;
                    case 34: //Page-Down
                        soundTypewriter();
                        moveCursorDown();
                        moveCursorDown();
                        moveCursorDown();
                        moveCursorDown();
                        moveCursorDown();
                        break;
                    case 35:
                        soundTypewriter();
                        moveCursorEND();
                        break;
                    case 36:
                        soundTypewriter();
                        moveCursorPOS1();
                        break;
                    case 37:
                        soundTypewriter();
                        moveCursorLeft(event.ctrlKey);
                        break;
                    case 38:
                        soundTypewriter();
                        moveCursorUp();
                        break;
                    case 39:
                        soundTypewriter();
                        moveCursorRight(event.ctrlKey);
                        break;
                    case 40:
                        soundTypewriter();
                        moveCursorDown();
                        break;
                        //Remove: DEL and CTRL+DEL
                    case 8:
                        soundTypewriter();
                        backspace(event.ctrlKey);

                        event.preventDefault();
                        event.stopPropagation(); //for Webbrowser Opera (prevent back navigation)
                        break;
                    case 46:
                        soundTypewriter();
                        del(event.ctrlKey);
                        break;

                        //Specials: configuration
                    case 65: //Toggle text alignment (ALT+A)
                        if (event.altKey) {
                            toggleTextAlignment();
                            event.preventDefault();
                        }
                        break;
                    case 87: //Toggle page width (ALT+W)
                        if (event.altKey) {
                            togglePageWidth();
                            event.preventDefault();
                        }
                        break;
                    case 67: //Toggle color (ALT+C)
                        if (event.altKey) {
                            toggleBackgroundColor();
                            event.preventDefault();
                        }
                        break;
                    case 86://Toggle typewriter-volume (ALT+V)
                        if (event.altKey) {
                            toggleTypewriterVolume();
                            event.preventDefault();
                        }
                        break;
                        //Specials: functionality
                    case 83:  //Save document (ALT-S)
                        if (event.altKey) {
                            saveDownload();
                            event.preventDefault();
                        }
                        break;
                    case 78:  //Download document (ALT-N)
                        if (event.altKey) {
                            window.open(window.location.href, '_blank');
                            ;
                            event.preventDefault();
                        }
                        break;
                    case 72:  //Toggle help (ALT-H)
                        if (event.altKey) {
                            helpPopup = window.open("./README.md", "_blank");
                            event.preventDefault();
                        }
                        break;
                    case 32:
                        if (event.ctrlKey) { //Open Thesaurus (CTRL-SPACE)
                            thesaurusLookup();
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        break;
                }
            }

            function handleKeyPress(event) {
                //console.log(event);

                switch (event.keyCode) {
                    case 8: //for Webbrowser Opera (prevent back navigation)
                        return false;
                        break;
                    case 13: //Add new paragraph
                        soundTypewriter();
                        newParagraph();
                        break;
                    case 32: // Add space
                        soundTypewriter();
                        write(" ");
                        break;
                    default: //Add text
                        soundTypewriter();
                        write(String.fromCharCode(event.charCode));
                        break;
                }
            }

            function soundTypewriter() {
                var audioTypewriter = document.getElementById("audioTypewriter");
                if (audioTypewriter.muted) return;

                var sound = audioTypewriter.cloneNode(true);
                sound.removeAttribute("muted"); //cloneNode(true) copies the initial muted value.
                sound.play();
            }

            /*
             * Per word navigation.
             */
            //String defining the regular expression for \p{LETTER}
            var regexUnicodeLetter = "[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376-\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4-\u07F5\u07FA\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0972\u097B-\u097F\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58-\u0C59\u0C60-\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E46\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1159\u115F-\u11A2\u11A8-\u11F9\u1200-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u1676\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F0\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19A9\u19C1-\u19C7\u1A00-\u1A16\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2C6F\u2C71-\u2C7D\u2C80-\u2CE4\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400\u4DB5\u4E00\u9FC3\uA000-\uA48C\uA500-\uA60C\uA610-\uA61F\uA62A-\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA717-\uA71F\uA722-\uA788\uA78B-\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA90A-\uA925\uA930-\uA946\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAC00\uD7A3\uF900-\uFA2D\uFA30-\uFA6A\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]"
            //Returns the start position of the last word (the last in the provided string); -1 if not found.
            function wordLastEndIndex(string) {
                var regex = new RegExp("[\\s]*" + regexUnicodeLetter + "+$");
                return string.search(regex);
            }
            //Returns the end position of the first word (the last in the provided string); -1 if not found.
            function wordFirstStartIndex(string) {
                var regex = new RegExp("" + regexUnicodeLetter + "+" + "[\\s]*");
                var match = string.match(regex);
                if (match !== null && match[0] !== undefined && match.index == 0) return match[0].length;
                return -1;
            }
            function wordCurrent(stringBefore, stringAfter) {
                var beginIndex = wordLastEndIndex(stringBefore);
                var endIndex = wordFirstStartIndex(stringAfter);

                var currentWord = "";
                if (beginIndex >= 0) currentWord = stringBefore.substring(beginIndex, stringBefore.length);
                if (endIndex >= 0) {
                    var secondPart = stringAfter.substring(0, endIndex);
                    currentWord = currentWord.concat(secondPart);
                }
                return currentWord.trim();
            }

            /**
             Navigation.
             */
            function moveCursorUp(index) {
                var cursor = document.getElementById("cursor");

                moveCursorTo(index, cursor.parentElement.previousElementSibling);
            }
            function moveCursorDown(index) {
                var cursor = document.getElementById("cursor");

                moveCursorTo(index, cursor.parentElement.nextElementSibling);
            }

            function moveCursorLeft(ctrl) {
                var cursor = document.getElementById("cursor");
                if (cursor.previousSibling === null) { //goto end of previous line
                    moveCursorUp(Number.MAX_VALUE);
                    return;
                }
                if (cursor.previousSibling.nodeType == 3 && cursor.previousSibling.length == 1) { //Is a text node and must not be splitted.
                    cursor.parentElement.insertBefore(cursor, cursor.previousSibling);

                    cursor.parentElement.normalize(); //Merge textNodes that where introduced.
                    return;
                }
                if (cursor.previousSibling.nodeType == 3 && cursor.previousSibling.length > 1) { //Is a text node and must be splitted into two; the cursor is inserted between.
                    var textNodeBefore = cursor.previousSibling;

                    var splitIdx = -1; //CTRL-Handling (one word to the left).
                    if (ctrl) splitIdx = wordLastEndIndex(textNodeBefore.data);
                    if (splitIdx == -1) splitIdx = textNodeBefore.length - 1;

                    var textNodeAfter = textNodeBefore.splitText(splitIdx);

                    cursor.parentElement.insertBefore(cursor, textNodeAfter);

                    cursor.parentElement.normalize(); //Merge textNodes that where introduced.
                    return;
                }
            }
            function moveCursorRight(ctrl) {
                var cursor = document.getElementById("cursor");
                if (cursor.nextSibling == null) { //goto beginning of next line
                    moveCursorDown(0);
                    return;
                }
                if (cursor.nextSibling.nodeType == 3 && cursor.nextSibling.length == 1) { //Is a text node and must not be splitted.
                    cursor.parentElement.insertBefore(cursor, cursor.nextSibling.nextSibling); //Sadly there is no insert after.

                    cursor.parentElement.normalize(); //Merge textNodes that might be introduced.
                    return;
                }
                if (cursor.nextSibling.nodeType == 3 && cursor.nextSibling.length > 1) { //Is a text node and must be splitted into two; the cursor is inserted between.
                    var textNodeBefore = cursor.nextSibling;

                    var splitIdx = -1; //CTRL-Handling (one word to the right).
                    if (ctrl) splitIdx = wordFirstStartIndex(textNodeBefore.data);
                    if (splitIdx == -1) splitIdx = 1;


                    var textNodeAfter = textNodeBefore.splitText(splitIdx);

                    cursor.parentElement.insertBefore(cursor, textNodeAfter);

                    cursor.parentElement.normalize(); //Merge textNodes that might be introduced (empty nodes are removed).
                    return;
                }
            }

            function moveCursorPOS1() {
                var cursor = document.getElementById("cursor");
                currentParagraph.insertBefore(cursor, currentParagraph.childNodes[0]);
            }
            function moveCursorEND() {
                currentParagraph.appendChild(cursor);
            }
            //If index is null, value from newCurrentParagraph is taken.
            function moveCursorTo(newIndex, newCurrentParagraph) {
                if (newIndex == null && newCurrentParagraph == null) return;

                var cursor = document.getElementById("cursor");
                cursor.parentElement.setAttribute("data-cursor-position", getCursorPosition());

                var currentParagraph = cursor.parentElement;
                var newCurrentParagraph = newCurrentParagraph || currentParagraph;

                var index = newIndex !== null ? newIndex : newCurrentParagraph.getAttribute("data-cursor-position");
                if (index === null) index = Number.MAX_VALUE;

                //Cleanup old paragraph
                cursor.remove();
                currentParagraph.normalize();

                newCurrentParagraph.normalize();

                //Set cursor
                var textNode = newCurrentParagraph.firstChild;
                if (index === 0 || textNode === null) {
                    newCurrentParagraph.insertBefore(cursor, textNode);
                    setCurrentParagraph(newCurrentParagraph);
                    return;
                } else {
                    if (index > textNode.length) {
                        newCurrentParagraph.appendChild(cursor);
                        setCurrentParagraph(newCurrentParagraph);
                        return;
                    }
                }
                var textNodeAfter = textNode.splitText(index);
                newCurrentParagraph.insertBefore(cursor, textNodeAfter);
                setCurrentParagraph(newCurrentParagraph);
            }

            function moveCursorToClick(textNode, offset) {
                var newCurrentParagraph = textNode.parentElement;
                console.log("Moving cursor to mouse to " + offset + " in " + newCurrentParagraph);

                var cursor = document.getElementById("cursor");

                var oldCurrentParagraph = cursor.parentElement;

                //If the user clicks right from the cursor, this adds an additional offset that must be stored as normalize() will remove it.
                var additionalOffset = 0;
                if (oldCurrentParagraph == newCurrentParagraph)
                    if (textNode.previousElementSibling == cursor)
                        additionalOffset = cursor.previousSibling.length;

                moveCursorTo(offset + additionalOffset, newCurrentParagraph);
            }

            function getCursorPosition() {
                var cursor = document.getElementById("cursor");
                if (cursor.previousSibling == undefined) return 0;
                return cursor.previousSibling.length;
            }

            /*
             * Mouse navigation in text using selection range.
             */
            function handleMouseClick(event) {
                console.log("Moving cursor to mouse click");

                var textNode = null;
                var offset = -1;

                if (document.caretPositionFromPoint) {
                    var range = document.caretPositionFromPoint(event.pageX, event.pageY);
                    textNode = range.offsetNode;
                    offset = range.offset;
                } else if (document.caretRangeFromPoint) { //for webkit
                    var range = document.caretRangeFromPoint(event.pageX, event.pageY);
                    textNode = range.startContainer;
                    offset = range.startOffset;
                }
                if (textNode.nodeType == 3) moveCursorToClick(textNode, offset);
                else console.log("...not moving cursor as click was not on textnode.");
            }

            /**
             Currentline positioning and highlightening.
             */
            window.onresize = function (event) {
                setCurrentParagraph(document.getElementById("currentParagraph"));
            };
            function setCurrentParagraph(newCurrentParagraph) {
                //Update id=currentParagraph
                var oldCurrentParagraph = document.getElementById("currentParagraph");
                if (oldCurrentParagraph !== undefined && newCurrentParagraph !== oldCurrentParagraph) {
                    oldCurrentParagraph.removeAttribute("id");
                    oldCurrentParagraph.className = "";

                    oldCurrentParagraph.normalize(); //Merges the textNodes into one.
                }
                newCurrentParagraph.id = "currentParagraph";
                newCurrentParagraph.className = "currentParagraph";

                centerCurrentParagraph(newCurrentParagraph);
            }
            function centerCurrentParagraph(newCurrentParagraph) {
                //New school: Just center the cursor.
                var centeringOffset = (window.innerHeight / 2) - cursor.offsetTop;
                page.style.top = centeringOffset + "px";
            }


            /**
             * Writing, deleting and adding new lines.
             *
             * Limitation: no sequences of whitespaces are written.
             */
            function write(character) {
                if (!(typeof character == 'string' || character instanceof String)) {
                    console.log("Warning can only write strings")
                }

                {//Handle new lines properly.
                    var textByLines = character.split("\n");
                    if (textByLines.length > 1) {
                        for (i = 0; i < textByLines.length; i++) {
                            write(textByLines[i]);
                            newParagraph();
                        }
                        return;
                    }
                }

                var cursor = document.getElementById("cursor");

                var currentParagraph = document.getElementById("currentParagraph");
                var currentParagraphOldHeight = currentParagraph.offsetHeight;

                if (cursor.previousSibling !== null && cursor.previousSibling.nodeType == 3) {
                    cursor.previousSibling.appendData(character);
                } else {
                    var toAdd = document.createTextNode(character);
                    currentParagraph.insertBefore(toAdd, cursor);
                }

                if (currentParagraphOldHeight != currentParagraph.offsetHeight) centerCurrentParagraph();
            }

            function backspace(ctrl) {
                console.log("BACKSPACE");
                var cursor = document.getElementById("cursor");
                var currentParagraph = document.getElementById("currentParagraph");

                //Line delete.
                if (cursor.previousSibling === null) { //Remove line and append to previous
                    var previousLine = currentParagraph.previousElementSibling;
                    if (previousLine != null) {
                        moveCursorLeft();

                        var toAppend = currentParagraph.childNodes.length;
                        for (var i = 0; i < toAppend; i++) {
                            previousLine.insertBefore(currentParagraph.childNodes[i], null);
                        }

                        currentParagraph.remove(); //Now remove the line.
                    }

                    centerCurrentParagraph();
                    return;
                }

                var currentParagraphOldHeight = currentParagraph.offsetHeight;
                //Normal delete
                if (cursor.previousSibling.nodeType == 3) {
                    if (cursor.previousSibling.length == 1) { //Is a text node and must not be splitted.
                        cursor.previousSibling.remove();
                    } else { //Just delete before the cursor.
                        var toDeleteIndex = cursor.previousSibling.length - 1;

                        if (ctrl) { //Delete previous word?
                            var previousWordStartIndex = wordLastEndIndex(cursor.previousSibling.data);
                            toDeleteIndex = (previousWordStartIndex != -1) ? previousWordStartIndex : toDeleteIndex;
                        }
                        if (toDeleteIndex == 0) cursor.previousSibling.remove();
                        else cursor.previousSibling.deleteData(toDeleteIndex, cursor.previousSibling.length - toDeleteIndex);
                    }
                } else {
                    console.log("Error: Encountered a non-text node.");
                }

                if (currentParagraphOldHeight != currentParagraph.offsetHeight) centerCurrentParagraph();
            }

            function del(ctrl) {
                console.log("DEL");
                var currentParagraph = document.getElementById("currentParagraph");

                //Line delete.
                if (cursor.nextSibling === null) { //Remove line and append to previous
                    var nextLine = currentParagraph.nextElementSibling;
                    if (nextLine != null) {

                        var toAppend = nextLine.childNodes.length;
                        for (var i = 0; i < toAppend; i++) {
                            currentParagraph.insertBefore(nextLine.childNodes[i], null)
                        }

                        nextLine.remove(); //Now remove the line.
                    }

                    centerCurrentParagraph();
                    return;
                }

                var currentParagraphOldHeight = currentParagraph.offsetHeight;
                //Normal delete
                if (cursor.nextSibling.nodeType == 3) {
                    if (cursor.nextSibling.length == 1) { //Is a text node and must not be splitted.
                        cursor.nextSibling.remove();
                    } else { //Just delete before the cursor.
                        var toDeleteIndex = 1;

                        if (ctrl) { //Delete next word?
                            var firstWordEnd = wordFirstStartIndex(cursor.nextSibling.data)
                            toDeleteIndex = (firstWordEnd != -1) ? firstWordEnd : toDeleteIndex;
                        }
                        if (toDeleteIndex == cursor.nextSibling.length) cursor.nextSibling.remove();
                        else cursor.nextSibling.deleteData(0, toDeleteIndex);
                    }
                } else {
                    console.log("Error: Encountered a non-text node.");
                }

                if (currentParagraphOldHeight != currentParagraph.offsetHeight) centerCurrentParagraph();
            }

            function newParagraph() {
                console.log("New paragraph");
                var cursor = document.getElementById("cursor");
                var currentParagraph = document.getElementById("currentParagraph");

                var newParagraph = document.createElement("div");

                if (cursor.nextSibling !== null) { //Need to move existing content to new line.
                    newParagraph.appendChild(cursor.nextSibling);
                }

                currentParagraph.parentNode.insertBefore(newParagraph, currentParagraph.nextElementSibling); //Insert paragraph

                moveCursorDown();
            }

            /**
             Change the UI.
             These functions overwrite the styles set by the css class #editor by setting the intended property directly at the editor element.
             The original value of the CSS definition cannot be accessed and thus the initial value must be guessed.
             Please make sure to be failsafe here.
             */
            function toggleTextAlignment() {
                console.log("Changing text alignment");
                var editor = document.getElementById("editor");
                editor.style.textAlign = editor.style.textAlign === "center" ? "left" : "center";
            }

            function togglePageWidth() {
                console.log("Changing page width");
                var page = document.getElementById("page");
                page.style.width = page.style.width === "40%" ? "80%" : "40%";
                centerCurrentParagraph();
            }

            function toggleBackgroundColor() {
                console.log("Changing background color");
                var editor = document.getElementById("editor");
                if (editor.style.backgroundColor === "rgb(245, 245, 245)") //"whitesmoke" is replaced by color code.
                    editor.style.backgroundColor = "white";
                else editor.style.backgroundColor = "whitesmoke";
            }

            function toggleTypewriterVolume() {
                console.log("(Un)muting typing sound");
                var audioTypewriter = document.getElementById("audioTypewriter");
                audioTypewriter.muted = !audioTypewriter.muted;
            }
        </script>
        <script type="text/javascript">
            /**
             Save
             */
            function getText() {
                return document.getElementById("page").innerText;
            }

            function saveDrag(event) { //requires body:ondragstart="saveDrag(event)"
                console.log("Drag start");
                event.dataTransfer.setData("text", getText());
                event.dataTransfer.setData("TheSchreibmaschine", "YES");
                event.dataTransfer.setDragImage(document.getElementById("dragPreview"), 0, 0);
            }

            function saveDownload() {
                var textFileAsBlob = new Blob([getText()], {type: 'text/plain'});
                var fileNameToSaveAs = "TheSchreibmaschine - " + new Date().toJSON() + ".txt";

                var downloadLink = document.createElement("a");
                downloadLink.download = fileNameToSaveAs;
                downloadLink.innerHTML = "Download File";
                downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
                downloadLink.click();
            }
        </script>
        <script type="text/javascript">
            /**
             Support CTRL-V, e.g. pasting from clipboard (works in Chrome and probably IE).
             */
            document.onpaste = function (event) {
                console.log("CTRL-V: Handle paste from clipboard");

                if (event.clipboardData.types.indexOf("text/plain") >= 0) {
                    var content = event.clipboardData.getData("text/plain");
                    write(content);
                }
            };
            document.oncopy = function (event) {
                console.log("CTRL-C: Handle copy to clipboard");
                event.preventDefault();
                event.clipboardData.setData("text/plain", getText());
            };


            /**
             Load data from a file or clipboard.
             No error check is done.
             */
            function loadAllowDrop(event) {
                //console.log("Allow drop");
                event.stopPropagation();
                event.preventDefault();
                event.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
            }

            function loadDrop(event) {
                loadAllowDrop(event);

                if (event.dataTransfer.getData("TheSchreibmaschine") !== "") { //By standard "" means nothing there, i.e. undefined.
                    console.log("LoadDrop: Drops from myself are not allowed; there is no copy and paste here.");
                    return;
                }

                console.log("LoadDrop: we are loading now.");

                if (event.dataTransfer.types.indexOf("text/plain") >= 0) {
                    var content = event.dataTransfer.getData("text/plain");
                    write(content);
                    console.log(content);

                    return; //Handle only PLAIN or FILES!
                }
                if (event.dataTransfer.types.indexOf("Files") >= 0) {
                    var files = event.dataTransfer.files;
                    //Check how multiple files are handled.
                    for (var i = 0; i < files.length; i++) {
                        console.log(files[i]);
                        var reader = new FileReader();
                        reader.onload = function () {
                            content = reader.result;
                            write(content);
                            console.log(content);
                        };
                        reader.onerror = function () {
                            console.log("Error during reading: " + reader.error);
                        };
                        reader.readAsText(files[i]);
                    }
                }
            }
        </script>
        <script type="text/javascript">
            /**
             * Updates UI after loading and sets writes added from url param.
             */
            function load() {
                window.onresize();

                if (window.location.search.length > 0) {
                    write(decodeURIComponent(window.location.search.substr(1, window.location.search.length)));
                }
            };
        </script>
        <script type="text/javascript">
            /**
             * Thesauri
             */
            var thesaurusAutoHideTimeout = null;
            function thesaurusLookup() {
                var cursor = document.getElementById("cursor");

                var stringBefore = cursor.previousSibling !== null ? cursor.previousSibling.data : "";
                var stringAfter = cursor.nextSibling !== null ? cursor.nextSibling.data : "";

                var word = wordCurrent(stringBefore, stringAfter);
                console.log("Thesaurus: DE")

                //Start UI 
                var thesaurusUI = document.getElementById("thesaurusUI");
                thesaurusUI.children["loading"].style.opacity = 1;
                thesaurusUI.children["result"].style.opacity = 0;

                try {
                    var synonyms = thesaurus["de"].lookup(word).sort();
                    //TODO Remove searched word and set it to front.
                    console.log(synonyms);
                    thesaurusUI.children["loading"].style.opacity = 0;
                    thesaurusUI.children["result"].style.opacity = 1;

                    thesaurusUI.children["result"].innerHTML = synonyms.length > 0 ? synonyms.join(", ") : "n/a";
                } catch (e) {
                    console.log("Thesaurus not available? The error message is: " + e);
                    thesaurusUI.children["result"].innerHTML = "... not working...";
                }
                clearTimeout(thesaurusAutoHideTimeout);
                thesaurusAutoHideTimeout = setTimeout(thesaurusAutoHide, 10000);
            }
            function thesaurusAutoHide() {
                var thesaurusUI = document.getElementById("thesaurusUI");
                thesaurusUI.children["loading"].style.opacity = 0;
                thesaurusUI.children["result"].style.opacity = 0;
                thesaurusUI.children["result"].innerHTML = "";
            }

        </script>        
        <script type="text/javascript" src="thesaurus/openthesaurus_de.js"></script>

        <style>
            html, body {
                height: 100%;
                margin: 0;
            }
            #editor {
                position:fixed;
                width:100%;
                height:100%;
                display: box;
                box-orient: vertical;
                box-pack: center;
                box-align: center;

                outline: none;

                overflow: hidden;

                background-color: white;
                font-family: "courier";
                text-rendering: optimizeLegibility;

                word-wrap:break-word;
                word-break:break-all; /*Required so longer text stays in line with cursor and does not break into new line.*/

                /*-webkit-touch-callout: none; Not yet required, there is no such thing as touchscreen support here.*/
                user-select: none;

                transition: all 1s;
            }

            #page {
                position: absolute;
                left: 0;
                right: 0;
                margin: 0 auto;
                width : 80%;

                transition: top 0.3s;
            }

            #page > div {
                color: lightgrey;
                min-height: 1.1em;

                -padding-top: 1em;
                margin-top: 0.2em;

                white-space:pre-wrap;

                transition: all 0.3s linear;

                hyphens: auto;
            }


            #page > div.currentParagraph {
                color: black;
                -padding-top: 1em;
            }

            #cursor {
                display: inline-block;
                background: #111;
                height:1em;
                width:0.1em;
                animation: blink 3s infinite;
            }

            @keyframes blink {
                0% {opacity: 1;}
                40% {opacity: 1;}
                70% {opacity: 0.2;}
                100% {opacity: 1;}
            }

            #thesaurusUI {
                position: absolute;

                left: 0;
                right: 0;
                bottom: 0;
                margin: 0 auto;
                margin-bottom: 0.3em;
                width : 60%;

                font-size: 0.8em;

                text-align: center;
            }

            #thesaurusUI > .loading {
                position:absolute;
                left:0;
                right:0;
                bottom:0;
                height:100%;
                width:100%;

                transition:opacity 1000ms ease-out;
            }

            #thesaurusUI > .result {
                position:absolute;
                left:0;
                right:0;
                bottom:0;
                width:100%;
                z-index:10;

                transition:opacity 1000ms ease-out;
            }

            #thesaurusUI > .loading > div {
                display:inline-block;
                /*float: left;*/
                width: 0.3em;
                height: 0.3em;
                margin: 0 0.3em;
                background: lightgrey;

                -webkit-border-ras: 50%;

                border-radius: 50%;

                opacity: 0;

                box-shadow: 0 0 2px black;

                animation: loadingFade 1s infinite;
            }

            #thesaurusUI > .loading > div:nth-child(2) {
                animation-delay: 0.1s;
            }

            #thesaurusUI > .loading > div:nth-child(3) {
                animation-delay: 0.2s;
            }

            #thesaurusUI > .loading > div:nth-child(4) {
                animation-delay: 0.3s;
            }

            @keyframes loadingFade {
                0% { opacity: 0; }
                50% { opacity: 0.8; }
                100% { opacity: 0; }
            }
        </style>
    </head>
    <body onload="load()" onbeforeunload="return 'Hope you saved your text.';">
        <div id="editor" 
             ondragstart="saveDrag(event)"
             ondragover="loadAllowDrop(event)"
             ondrop="loadDrop(event)"
             draggable="true"
             ondblclick="saveDownload()"
             tabindex="1" onkeypress="handleKeyPress(event)" onkeydown="handleKeyDown(event)" >
            <div id="page" onclick="handleMouseClick(event)">
                <div id="currentParagraph"><div id="cursor"></div></div>
            </div>
            <audio id="audioTypewriter" hidden="hidden" muted>
                <source type="audio/ogg" src="data:audio/ogg;base64,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" >
                <source type="audio/mpeg" src="data:audio/mpeg;base64,//tQxAAAB+gPR1QxgAHHpa93HrADAAdABpNyYAEUDAwMDD5cH33RcHwfdEAIAmD/8vE4Pn/T4ISgY/6fggCAIGQfB8H4IAgCFIPh//4wEAQdWD/nLHY/b8/Xo836dQGhYAA6avqskSFrLPiAolFCZIL4pBFH8M3DvsvHcRzVdcdvZOtjBsLD5tTHxTpo5Tzivvk1zl84OxI9g7z6tu9tVFV58CAHBLHA77lzuHf//47x3nzQ0OP+W13w53///roHEK2f9Lzsqk42o3EokmUAAP/7UsQEgAuosYGYlIABbpFv855gB4MQEDi4pFWk4kRiuSy7ZZkkShNVHFOT8LLB4Qio17n3NEyTZPFmkEKIGyyU9xVDXY+Y31V3JPalFTavIKMb/tqEwsERVRQuA3vGGnjtV4PonJST463XS6MIABYr5OTE2S070LQhcJ2IlkMGS0PDePiSIEaM1c0qa5y2+ZTA1JNu621rb9pq369zublFBTabnnIp/J4YYnDC5PJdV0K0vaXXNb09ZEmv+U/2c//////7l0kraJBBKVx2kJOE//tSxAYAC5DPc7TxgBmHoK3/HoAAn5BDFWSSnwwK9NKdQPLQmISAgkZ3EkTUoKgJwWd1qqfCb791pcOy5KRwlLKyNVpJ6Qlv3SKoeM8wyaClMxzrSG7936/mA2h///9lVlllLFsnh5VoRjRTIiI5KygQmK6AE8ZIbqLIPapc47fMxGqcDXJO/FBox9g7oRxBOV3Q8Si4oIJpoq1OaFhp0jOHcSR6QgOSHxNi3rrH//vMJLfKx//jzJqXn1pq6u2///FFHyzj/QpEaGRUMQAAAUr/+1LEBIPLHFtL/MMACAAANIAAAAQKwEgPCMB4RhGfKoTCUDYCQNidc5JICAQCARKtmfMzM9qmZIkSJEjLwUFFeCgoL//x/+CgoKFBX9BgoKCgrIKCn//4goUFP/oKb8IFFf4SC0xBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==">
                <source type="audio/opus" src="data:audio/opus;base64,T2dnUwACAAAAAAAAAACxzoIoAAAAALgetnMBE09wdXNIZWFkAQFkAUSsAAAAAABPZ2dTAAAAAAAAAAAAALHOgigBAAAAy2HXSQFHT3B1c1RhZ3MNAAAAbGlib3B1cyAxLjAuMQEAAAAmAAAARU5DT0RFUj1vcHVzZW5jIGZyb20gb3B1cy10b29scyAwLjEuMgpPZ2dTAATQDQAAAAAAALHOgigCAAAAma3B2Qf/F/8N/wL6+H6Lin/MkyIP/GetK725YbZkN6h+T6O2+Gt4OcDvEQz5Q41sgW+me4E8ScurUyZHMiQqXl1QAtqpga3zP06i3wm/Jdl5RSO3kjfs8QrABKiNhBKM5636Yp5j3b0uruWh3TVgLl/5oV0MMBH+4ZgaRAh1JWWxAXVZgi97t0aN9xcAuz5V9bPwM8jU8WeSIMLS+iMPaDYgNSM8LYJENMXvLi2wuX04vDGuusfgJOt0VwGxvdxofZ+hD6C2lQ0w/bIWFO4lP2G9klyv4n9ohTKWCHqaIH8TY1JhnLW94cnaO4X5bR4yGZav8QTQ3ZZD1Su/gIVyAS75n14fEO3fLFM3yCNXYJfk6QQQ35+bMviTxCM/Di9FKeX4fKHxt7J5/SzzNUxW3xp+r65y5inNwbopxFvvsJubPxrOwQ61s0k8vOrV9b9XKh7/8UrrLh0f3NLzc1K1O7DH5SDMeW+rvf6tVeJc16ydHMbXG5jOo2PWkOHqKxq4Bp230lrB7HHRy1tGe2ewiumembSpfBnzr+4xcpH83XU65vvLqM2DxciYB9UhkwybEDksgZa4Aa90qWEylG24tB0XRxZseJw78mhZWp5k2eRl9bNJX9jfv9wClZUNPo6XoopRR6Gke82HrQPC/FyjgkRB60Lx4Cb5GLLDvl7GdEpJdXzoCtlL34enHkmLzvza2BmrMsrJdpOT3tsJrU7KMijLpPJ/6oVun1yVqswB+HBEcrUkWjNNRByLbW3w6Zlk7uz0Wg8N1gTxFiier1Kx1haJOadG5y8X/T4v56Qj0411lk8HXqs4B54Oe0ruWJPKbEC0eJqfkge7cNilmqPLTQPDMncM7ZAduzW66z5ATBP3gLQqRR+aEdctwbIiDqs2CICGAk4Q4pOQP/aUCY2pC3WoQx6+ONXYUAmhs4G1mPXNlzbtScDCrq0lLTIE4U00pO3Ut6bEF92zsR/ND+00WBCOYdlqjv94en295VzPUK97qM/Q1BBKIfgQhkdP+2klvB7wxKSoZgFbLf21JNhc96IoAnSkRhucE4bLodGaxIaXSywvBsIEAaoB2p5hksX4cHCOw/WgZbCHgvci8rIDAhZiGf6BErTQS9WFhIfB3HHgkNwfrZGKwdgE9J4CyMTMzeyBk4jCyPqGxozJ8bxEf/S5tux/2SAuGu2PpJEWtVwXc6OmokWZOLhA/ZxsFiRG3lzi53YNgqz34iSGvxEa4a41JBZLDqzkfze3tDXSFLrsSdhqipfXcgz2kc1azPw4YvX32KjqSggB3s/ciFHwfSfhqKLMoTgRg6mQVsYi5d/JjwApqAfO1zqpJ8Rp3fMPysPqfYDVlX58fZLDdui9yEYB6kt4YAV32DOixbTBwCs6AykdnvobLQqNb0+W3TP3vSuiNT48kCyB" >
                <source type="audio/wav" src="data:audio/wav;base64,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">
            </audio>
            <img id="dragPreview" src="" alt=""/>
            <div id="thesaurusUI">
                <div name="loading" class="loading" style="opacity:0">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
                <div name="result" class="result" style="opacity:0"></div>
            </div>
        </div>
    </body>
</html>
